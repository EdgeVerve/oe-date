<!-- 
  Â©2016-2017 EdgeVerve Systems Limited (a fully owned Infosys subsidiary),
  Bangalore, India. All Rights Reserved.
-->


<link rel="import" href="../polymer/polymer.html">

<link rel="import" href="../paper-input/paper-input-behavior.html">
<link rel="import" href="../oe-field-behavior/oe-field-behavior.html">
<link rel="import" href="behaviors/oe-date-behavior.html">
<link rel="import" href="../oe-input/oe-input.html">
<link rel="import" href="oe-datepicker-dlg.html">

<!--
An input control to capture `date` data. `value` property exposes the selected date always in midnight UTC.
@demo demo/demo-oe-date.html
-->

<dom-module id="oe-date">
  <template>
    <style>
      .date-button {
        color: var(--secondary-text-color);
        padding: 0;
        margin: 0;
        min-width: 0;
      }

      :host {
        display: block;
      }

    </style>
    <oe-datepicker-dlg value="{{value}}" id="_picker" max=[[max]] min=[[min]]></oe-datepicker-dlg>
    <oe-input id="display" label=[[label]] required=[[required]] disabled=[[disabled]] validator=[[validator]] no-label-float=[[noLabelFloat]]
      invalid={{invalid}} error-message={{errorMessage}} error-placeholders={{errorPlaceholders}} max=[[max]] min=[[min]]>

      <paper-button hidden$=[[hideIcon]] suffix class="date-button" tabindex="-1" on-tap="_showDatePicker">
        <iron-icon icon="today"></iron-icon>
      </paper-button>
    </oe-input>

  </template>

  <script>
    Polymer({
      is: 'oe-date',
      properties: {

        /* Initial/default value for the control */
        init: {
          type: String
        },

        /**
         * Setting to true hides the calender icon in the control which open the datepicker dialog
         */
        hideIcon: {
          type: Boolean,
          value: false
        }
      },
      behaviors: [
        Polymer.PaperInputBehavior,
        baseUtils.DateInputBehavior,
        baseUtils.FieldBehavior
      ],
      listeners: {
        '_picker.oe-date-picked': '_datePicked'
      },
      attached: function () {

        //if value is set instead of date-value, trigger parsing of init-value
        if (!this.value && this.init) {
          this.$.display.set('value', this.init);
          this.$.display.fire('change');
        }

        if (this.max) {
          var newDate = this._parseShorthand(this.max);
          if (newDate) {
            this.set('max', newDate);
          } else {
            console.warn("Invalid 'max' date value", this.max);
          }
        }
        if (this.min) {
          var newDate = this._parseShorthand(this.min); // eslint-disable-line no-redeclare
          if (newDate) {
            this.set('min', newDate);
          } else {
            console.warn("Invalid 'min' date value", this.min);
          }
        }

      },
      _showDatePicker: function (e) { // eslint-disable-line no-unused-vars
        this.$._picker.open();
      },
      _datePicked: function (e) { // eslint-disable-line no-unused-vars
        this.validate();
      },

      /**
       * Returns a reference to the input element.
       */
      get inputElement() {
        return this.$.display.inputElement;
      }
    });

  </script>
</dom-module>
